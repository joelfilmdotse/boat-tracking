<!DOCTYPE html>
<html>
<head>
  <title>Båtspårning</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQPgoebWqFXyHmBYUPDd8-tRI170wyoJs"></script>
  <script>
    let map;
    let boats = {}; // Hållare för båtar och deras data

    // Initiera kartan
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 57.6082, lng: 11.7960 }, // Stockholm som exempel
        zoom: 10,
      });

      // Uppdatera båtar varje sekund
      setInterval(updateBoatPositions, 1000);
    }

    // Uppdatera båtar och deras positioner
    function updateBoatPositions() {
      // Exempeldata: Ersätt detta med dynamisk data från din server
      const gpsData = [
        { id: "boat1", lat: 57.6082, lng: 11.7960, speed: 5 },
        { id: "boat2", lat: 57.6081, lng: 11.7961, speed: 6 },
      ];

      gpsData.forEach(boat => {
        if (boats[boat.id]) {
          // Uppdatera markörens position
          boats[boat.id].marker.setPosition(new google.maps.LatLng(boat.lat, boat.lng));

          // Lägg till historiklinje
          const path = boats[boat.id].path.getPath();
          path.push(new google.maps.LatLng(boat.lat, boat.lng));

          // Uppdatera infofönster
          boats[boat.id].infoWindow.setContent(`
            <div>
              <strong>${boat.id}</strong><br>
              Hastighet: ${boat.speed} knop<br>
              Lat: ${boat.lat}<br>
              Lng: ${boat.lng}
            </div>
          `);
        } else {
          // Skapa ny markör och historiklinje
          const marker = new google.maps.Marker({
            position: { lat: boat.lat, lng: boat.lng },
            map: map,
            icon: {
              url: "https://img.icons8.com/emoji/48/sailboat-emoji.png", // Anpassad ikon
              scaledSize: new google.maps.Size(32, 32),
            },
            title: boat.id,
          });

          const path = new google.maps.Polyline({
            map: map,
            strokeColor: "#FF0000",
            strokeOpacity: 1.0,
            strokeWeight: 2,
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `<div>
              <strong>${boat.id}</strong><br>
              Hastighet: ${boat.speed} knop<br>
              Lat: ${boat.lat}<br>
              Lng: ${boat.lng}
            </div>`,
          });

          // Visa infofönster vid klick
          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });

          boats[boat.id] = { marker, path, infoWindow };
        }
      });
    }
  </script>
</head>
<body onload="initMap()">
  <div id="map" style="width: 100%; height: 100vh;"></div>
</body>
</html>
